## video 双向通话断网流程

### 通话前
    
   *  APP 断网时
       *  App 端：断网瞬间提示：暂时无网络，请检查网络状态，60s超时页面提示：对方无人接听，页面自动退出时提示： 连接超时，请检查设备状态。期间也可通过页面按钮正常挂断。
           *  设备端：从呼叫开始计时，15s内无操作后退出呼叫响应视图，期间也可通过页面按钮正常挂断。

   *  设备断网时
       * App 端：App 收到 p2p通道断开后提示：通道已断开，请重新拨打，60s超时页面提示：对方无人接听，自动退出页面时提示：连接超时，请检查设备状态。期间也可通过页面按钮正常挂断。   
           * 设备端：断网时呼叫页面显示：掉线 已断开连接，15s 内回复网络后，呼叫页面显示：已自动重连 在线，从呼叫开始计时，15s 内无操作后退出呼叫响应视图，期间也可通过页面按钮正常挂断。


### 通话中    

   *  APP 断网时
       * App 端：断网瞬间提示：暂时无网络，请检查网络状态，60s 超时后退出提示：连接超时，请检查设备状态。 60s 内恢复网络后，设备状态未挂断，尝试重连 p2p 通道直至 60s 超时，期间也可通过页面按钮正常挂断。   
       * 设备端：收到 p2p 通道断开后，在呼叫页面显示：p2p 通道断开，尝试重连，60s 内 p2p 通道如还未重连成功则退出呼叫页面。期间也可通过页面按钮正常挂断。
       
       通话中，设备断网时，双端流程简图如下：   
       ![设备断网](https://github.com/tencentyun/iot-link-ios/wiki/image/Two-way_audio_video_DeviceNoNetwork.png)
       
   *  设备断网时
       * App 端：App 收到 p2p 通道断开后提示：通道已断开，请重新拨打， 60s 超时后页面退出提示：连接超时，请检查设备状态。60 s内设备恢复网络，App 保持通话页面状态下，App 轮询建立 p2p 通道请求直至 60s 超时，期间也可通过页面按钮正常挂断，同时上报挂断状态。    
       * 设备端：断网时呼叫页面分别显示：掉线 已断开连接；p2p 通道断开，尝试重连， 重新上线时呼叫页面显示：已自动重连 在线，60s 内恢复网络后需上报新的 xp2pinfo 等待 APP 连接，直至 60s 超时。
      
           通话中，App 侧断网时，双端流程简图如下：    
       ![App断网](https://github.com/tencentyun/iot-link-ios/wiki/image/Two-way_audio_video_AppNoNetwork.png)
    

